<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin â€” Megapari Portal</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --green:#00e676;--green2:#00c853;--dark:#080c0a;--dark2:#0d1410;
    --card:#111a14;--card2:#162019;--border:rgba(0,230,118,0.15);
    --text:#e8f5e9;--muted:#7a9e85;--red:#ff5252;--amber:#ffab40;
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{background:var(--dark);color:var(--text);font-family:'Outfit',sans-serif;min-height:100vh;}
  body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at 20% 20%,rgba(0,230,118,0.05) 0%,transparent 50%);pointer-events:none;}

  /* LAYOUT */
  .admin-wrap{display:flex;min-height:100vh;}
  .sidebar{
    width:220px;background:var(--card);border-right:1px solid var(--border);
    padding:24px 0;flex-shrink:0;position:sticky;top:0;height:100vh;overflow-y:auto;
  }
  .sidebar .logo{padding:0 20px 24px;border-bottom:1px solid var(--border);margin-bottom:16px;}
  .logo-text{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--green);letter-spacing:2px;}
  .logo-sub{font-size:.65rem;color:var(--muted);letter-spacing:2px;text-transform:uppercase;}
  .nav-item{
    display:flex;align-items:center;gap:10px;padding:12px 20px;cursor:pointer;
    font-size:.85rem;font-weight:500;color:var(--muted);transition:all .15s;border-left:3px solid transparent;
  }
  .nav-item:hover{color:var(--text);background:rgba(0,230,118,0.05);}
  .nav-item.active{color:var(--green);border-left-color:var(--green);background:rgba(0,230,118,0.08);}
  .nav-sep{height:1px;background:var(--border);margin:8px 0;}

  .main{flex:1;padding:30px;overflow-y:auto;}
  .page{display:none;}
  .page.active{display:block;}

  /* PAGE HEADER */
  .page-header{margin-bottom:28px;}
  .page-header h1{font-family:'Bebas Neue',sans-serif;font-size:2rem;letter-spacing:3px;color:var(--text);}
  .page-header p{color:var(--muted);font-size:.85rem;margin-top:4px;}

  /* CARDS */
  .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:22px;margin-bottom:20px;}
  .card h3{font-size:.95rem;font-weight:600;margin-bottom:16px;color:var(--green);text-transform:uppercase;letter-spacing:1px;}

  /* FORMS */
  .form-row{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:14px;margin-bottom:14px;}
  .form-group{display:flex;flex-direction:column;gap:6px;}
  .form-group.full{grid-column:1/-1;}
  label{font-size:.72rem;text-transform:uppercase;letter-spacing:1.5px;color:var(--muted);}
  input[type=text],input[type=date],input[type=number],input[type=password],
  select,textarea{
    background:#0a1209;border:1px solid var(--border);border-radius:8px;
    color:var(--text);padding:10px 14px;font-family:'Outfit',sans-serif;font-size:.88rem;
    outline:none;transition:border-color .2s;width:100%;
  }
  input:focus,select:focus,textarea:focus{border-color:var(--green);}
  textarea{resize:vertical;min-height:100px;}

  /* BUTTONS */
  .btn{
    padding:10px 20px;border:none;border-radius:8px;font-family:'Outfit',sans-serif;
    font-size:.85rem;font-weight:600;cursor:pointer;transition:all .2s;letter-spacing:.5px;
  }
  .btn-green{background:var(--green);color:#000;}
  .btn-green:hover{background:var(--green2);}
  .btn-red{background:rgba(255,82,82,0.15);color:var(--red);border:1px solid rgba(255,82,82,0.3);}
  .btn-red:hover{background:rgba(255,82,82,0.25);}
  .btn-amber{background:rgba(255,171,64,0.15);color:var(--amber);border:1px solid rgba(255,171,64,0.3);}
  .btn-amber:hover{background:rgba(255,171,64,0.25);}
  .btn-outline{background:transparent;color:var(--green);border:1px solid var(--green);}
  .btn-outline:hover{background:rgba(0,230,118,0.1);}
  .btn-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px;}

  /* TABLE */
  .table-wrap{overflow-x:auto;margin-top:10px;}
  table{width:100%;border-collapse:collapse;font-size:.83rem;}
  th{padding:10px 14px;background:var(--card2);color:var(--muted);text-align:left;font-weight:600;
     font-size:.7rem;text-transform:uppercase;letter-spacing:1px;}
  td{padding:10px 14px;border-bottom:1px solid var(--border);}
  tr:hover td{background:rgba(0,230,118,0.03);}
  .badge{display:inline-block;padding:2px 8px;border-radius:4px;font-size:.68rem;font-weight:600;letter-spacing:.5px;}
  .badge-green{background:rgba(0,230,118,0.1);color:var(--green);border:1px solid rgba(0,230,118,0.2);}
  .badge-amber{background:rgba(255,171,64,0.1);color:var(--amber);border:1px solid rgba(255,171,64,0.2);}

  /* BANNER PREVIEW AREA */
  .preview-area{
    width:100%;background:#0a1209;border:2px dashed var(--border);border-radius:8px;
    min-height:200px;display:flex;align-items:center;justify-content:center;
    position:relative;overflow:hidden;cursor:crosshair;
  }
  .preview-area canvas{max-width:100%;display:block;margin:0 auto;}
  .promo-overlay{
    position:absolute;border:2px solid var(--green);pointer-events:none;
    background:rgba(0,230,118,0.1);
  }
  .preview-placeholder{text-align:center;color:var(--muted);}
  .preview-placeholder .icon{font-size:3rem;margin-bottom:8px;}

  /* DRAG instructions */
  .drag-info{font-size:.75rem;color:var(--amber);margin-top:8px;letter-spacing:.5px;}

  /* LOGIN */
  #login-screen{
    min-height:100vh;display:flex;align-items:center;justify-content:center;
    background:var(--dark);
  }
  .login-card{
    background:var(--card);border:1px solid var(--border);border-radius:16px;
    padding:40px;width:100%;max-width:380px;text-align:center;
  }
  .login-card .logo-text{font-size:2rem;display:block;margin-bottom:4px;}
  .login-card h2{font-size:1rem;color:var(--muted);margin-bottom:28px;}
  .login-card input{margin-bottom:12px;}
  .login-error{color:var(--red);font-size:.8rem;margin-bottom:10px;display:none;}

  /* TOAST */
  #admin-toast{
    position:fixed;bottom:30px;right:30px;
    background:var(--green);color:#000;padding:10px 20px;border-radius:30px;
    font-weight:700;font-size:.85rem;transition:opacity .3s;opacity:0;pointer-events:none;z-index:999;
  }
  #admin-toast.show{opacity:1;}

  @media(max-width:700px){
    .sidebar{display:none;}
    .main{padding:16px;}
  }
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="login-screen">
  <div class="login-card">
    <span class="logo-text" style="color:var(--green)">MEGA<span style="color:var(--text)">PARI</span></span>
    <h2>Admin Access</h2>
    <div class="form-group" style="margin-bottom:12px;">
      <label>Password</label>
      <input type="password" id="pw-input" placeholder="Enter admin password" onkeydown="if(event.key==='Enter')doLogin()"/>
    </div>
    <div class="login-error" id="login-error">Incorrect password</div>
    <button class="btn btn-green" style="width:100%" onclick="doLogin()">LOGIN â†’</button>
    <p style="margin-top:14px;font-size:.72rem;color:var(--muted)">Default password: <strong style="color:var(--text)">admin123</strong></p>
  </div>
</div>

<!-- ADMIN PANEL -->
<div class="admin-wrap" id="admin-panel" style="display:none">
  <nav class="sidebar">
    <div class="sidebar logo">
      <div class="logo-text">MEGA<span style="color:var(--text)">PARI</span></div>
      <div class="logo-sub">Admin Panel</div>
    </div>
    <div class="nav-item active" onclick="showPage('affiliates')">ğŸ‘¥ Affiliates</div>
    <div class="nav-item" onclick="showPage('banners')">ğŸ–¼ï¸ Banners</div>
    <div class="nav-item" onclick="showPage('texts')">âœï¸ Texts</div>
    <div class="nav-item" onclick="showPage('settings')">âš™ï¸ Settings</div>
    <div class="nav-sep"></div>
    <div class="nav-item" onclick="window.open('index.html','_blank')">ğŸ”— View Portal</div>
    <div class="nav-item" onclick="doLogout()">ğŸšª Logout</div>
  </nav>

  <main class="main">

    <!-- â•â•â• AFFILIATES â•â•â• -->
    <div class="page active" id="page-affiliates">
      <div class="page-header">
        <h1>AFFILIATES</h1>
        <p>Manage affiliate IDs, referral links, and promo codes</p>
      </div>

      <div class="card">
        <h3 id="aff-form-title">Add New Affiliate</h3>
        <input type="hidden" id="edit-aff-id">
        <div class="form-row">
          <div class="form-group">
            <label>Affiliate ID *</label>
            <input type="text" id="aff-id" placeholder="e.g. AFF12345"/>
          </div>
          <div class="form-group">
            <label>Display Name</label>
            <input type="text" id="aff-name" placeholder="e.g. John Doe"/>
          </div>
          <div class="form-group">
            <label>Promo Code *</label>
            <input type="text" id="aff-promo" placeholder="e.g. JOHN50"/>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Player / Referral Link</label>
            <input type="text" id="aff-player" placeholder="https://..."/>
          </div>
          <div class="form-group">
            <label>APK Link</label>
            <input type="text" id="aff-apk" placeholder="https://..."/>
          </div>
          <div class="form-group">
            <label>iOS Link</label>
            <input type="text" id="aff-ios" placeholder="https://..."/>
          </div>
        </div>
        <div class="form-group" style="margin-bottom:14px">
          <label>Preferred Language</label>
          <select id="aff-lang">
            <option value="en">English</option>
            <option value="fr">French</option>
            <option value="ar">Arabic</option>
            <option value="es">Spanish</option>
            <option value="pt">Portuguese</option>
          </select>
        </div>
        <div class="btn-row">
          <button class="btn btn-green" onclick="saveAffiliate()">ğŸ’¾ Save Affiliate</button>
          <button class="btn btn-outline" onclick="clearAffForm()">Clear</button>
        </div>
      </div>

      <div class="card">
        <h3>All Affiliates</h3>
        <div class="table-wrap">
          <table id="aff-table">
            <thead><tr><th>ID</th><th>Name</th><th>Promo Code</th><th>Lang</th><th>Actions</th></tr></thead>
            <tbody id="aff-tbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â•â•â• BANNERS â•â•â• -->
    <div class="page" id="page-banners">
      <div class="page-header">
        <h1>BANNERS</h1>
        <p>Upload banners with date ranges and set promo code placement</p>
      </div>

      <div class="card">
        <h3>Upload New Banner</h3>
        <div class="form-row">
          <div class="form-group">
            <label>Language</label>
            <select id="ban-lang">
              <option value="en">English</option>
              <option value="fr">French</option>
              <option value="ar">Arabic</option>
              <option value="es">Spanish</option>
              <option value="pt">Portuguese</option>
            </select>
          </div>
          <div class="form-group">
            <label>Banner Type</label>
            <select id="ban-type" onchange="toggleDates()">
              <option value="dated">Dated (has expiry)</option>
              <option value="evergreen">Evergreen (no expiry)</option>
            </select>
          </div>
          <div class="form-group" id="start-grp">
            <label>Start Date</label>
            <input type="date" id="ban-start"/>
          </div>
          <div class="form-group" id="end-grp">
            <label>End Date</label>
            <input type="date" id="ban-end"/>
          </div>
        </div>

        <div class="form-group" style="margin-bottom:14px">
          <label>Upload Banner Image (PNG/JPG)</label>
          <input type="file" id="ban-file" accept="image/*" onchange="loadBannerPreview()" style="background:transparent;border:1px dashed var(--border);padding:10px;"/>
        </div>

        <div class="form-group" style="margin-bottom:10px">
          <label>Banner Preview â€” Drag to set Promo Code Area</label>
          <div class="preview-area" id="preview-area">
            <div class="preview-placeholder" id="preview-placeholder">
              <div class="icon">ğŸ–¼ï¸</div>
              <div>Upload a banner to preview</div>
            </div>
            <canvas id="preview-canvas" style="display:none;max-width:100%;"></canvas>
            <div class="promo-overlay" id="promo-overlay" style="display:none;"></div>
          </div>
          <div class="drag-info">âš¡ Click and drag on the preview to mark the promo code zone</div>
        </div>

        <!-- Promo config display -->
        <div id="promo-config-display" style="display:none;margin-bottom:14px;">
          <div class="form-row">
            <div class="form-group">
              <label>Font Size (px)</label>
              <input type="number" id="pc-fontsize" value="28" min="8" max="100" onchange="updateOverlay()"/>
            </div>
            <div class="form-group">
              <label>Text Color</label>
              <input type="color" id="pc-color" value="#ffffff" style="height:40px;padding:4px;" onchange="updateOverlay()"/>
            </div>
            <div class="form-group">
              <label>Position Info</label>
              <input type="text" id="pc-info" readonly style="background:#0a1209;"/>
            </div>
          </div>
        </div>

        <div class="btn-row">
          <button class="btn btn-green" onclick="saveBanner()">ğŸ’¾ Save Banner</button>
          <button class="btn btn-outline" onclick="clearBannerForm()">Clear</button>
        </div>
      </div>

      <div class="card">
        <h3>All Banners</h3>
        <div class="table-wrap">
          <table>
            <thead><tr><th>Preview</th><th>Type</th><th>Language</th><th>Dates</th><th>Actions</th></tr></thead>
            <tbody id="ban-tbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â•â•â• TEXTS â•â•â• -->
    <div class="page" id="page-texts">
      <div class="page-header">
        <h1>POST CAPTIONS</h1>
        <p>Manage promotional text samples per language</p>
      </div>

      <div class="card">
        <h3 id="text-form-title">Add New Caption</h3>
        <input type="hidden" id="edit-text-id">
        <div class="form-row">
          <div class="form-group">
            <label>Language</label>
            <select id="txt-lang">
              <option value="en">English</option>
              <option value="fr">French</option>
              <option value="ar">Arabic</option>
              <option value="es">Spanish</option>
              <option value="pt">Portuguese</option>
            </select>
          </div>
        </div>
        <div class="form-group" style="margin-bottom:14px">
          <label>Caption Text (use {{Player link}}, {{apk link}}, {{iOS link}}, {{Promo code}})</label>
          <textarea id="txt-content" rows="7" placeholder="Type your caption here..."></textarea>
        </div>
        <div class="btn-row">
          <button class="btn btn-green" onclick="saveText()">ğŸ’¾ Save Caption</button>
          <button class="btn btn-outline" onclick="clearTextForm()">Clear</button>
        </div>
      </div>

      <div class="card">
        <h3>All Captions</h3>
        <div style="margin-bottom:12px;display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn btn-outline" onclick="filterTexts('all')" id="tf-all" style="font-size:.75rem;padding:6px 14px">All</button>
          <button class="btn btn-outline" onclick="filterTexts('en')" id="tf-en" style="font-size:.75rem;padding:6px 14px">English</button>
          <button class="btn btn-outline" onclick="filterTexts('fr')" id="tf-fr" style="font-size:.75rem;padding:6px 14px">French</button>
          <button class="btn btn-outline" onclick="filterTexts('ar')" id="tf-ar" style="font-size:.75rem;padding:6px 14px">Arabic</button>
          <button class="btn btn-outline" onclick="filterTexts('es')" id="tf-es" style="font-size:.75rem;padding:6px 14px">Spanish</button>
          <button class="btn btn-outline" onclick="filterTexts('pt')" id="tf-pt" style="font-size:.75rem;padding:6px 14px">Portuguese</button>
        </div>
        <div id="texts-admin-list"></div>
      </div>
    </div>

    <!-- â•â•â• SETTINGS â•â•â• -->
    <div class="page" id="page-settings">
      <div class="page-header">
        <h1>SETTINGS</h1>
        <p>Change admin password and manage data</p>
      </div>
      <div class="card">
        <h3>Change Admin Password</h3>
        <div class="form-row">
          <div class="form-group">
            <label>Current Password</label>
            <input type="password" id="cur-pw"/>
          </div>
          <div class="form-group">
            <label>New Password</label>
            <input type="password" id="new-pw"/>
          </div>
          <div class="form-group">
            <label>Confirm New Password</label>
            <input type="password" id="conf-pw"/>
          </div>
        </div>
        <button class="btn btn-green" onclick="changePassword()">ğŸ’¾ Update Password</button>
      </div>
      <div class="card">
        <h3>Data Management</h3>
        <p style="color:var(--muted);font-size:.85rem;margin-bottom:16px">Export or clear all portal data stored in the browser.</p>
        <div class="btn-row">
          <button class="btn btn-outline" onclick="exportData()">ğŸ“¤ Export All Data</button>
          <button class="btn btn-amber" onclick="importDataPrompt()">ğŸ“¥ Import Data</button>
          <button class="btn btn-red" onclick="clearAllData()">ğŸ—‘ï¸ Clear All Data</button>
        </div>
        <input type="file" id="import-file" accept=".json" style="display:none" onchange="importData()"/>
      </div>
      <div class="card">
        <h3>Stats</h3>
        <div id="stats-area" style="color:var(--muted);font-size:.88rem;line-height:2;"></div>
      </div>
    </div>

  </main>
</div>

<div id="admin-toast">Saved!</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getData(k,d){try{return JSON.parse(localStorage.getItem(k))||d;}catch(e){return d;}}
function setData(k,v){localStorage.setItem(k,JSON.stringify(v));}
function uid(){return Date.now().toString(36)+Math.random().toString(36).slice(2,6);}
const LANG_NAMES={en:'English',fr:'French',ar:'Arabic',es:'Spanish',pt:'Portuguese'};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function doLogin(){
  const pw=document.getElementById('pw-input').value;
  const stored=localStorage.getItem('adminPw')||'admin123';
  if(pw===stored){
    document.getElementById('login-screen').style.display='none';
    document.getElementById('admin-panel').style.display='flex';
    refreshAll();
  } else {
    document.getElementById('login-error').style.display='block';
  }
}
document.getElementById('pw-input').addEventListener('keydown',e=>{if(e.key==='Enter')doLogin();});
function doLogout(){
  document.getElementById('login-screen').style.display='flex';
  document.getElementById('admin-panel').style.display='none';
  document.getElementById('pw-input').value='';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showPage(p){
  document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active'));
  document.getElementById('page-'+p).classList.add('active');
  event.currentTarget.classList.add('active');
  if(p==='settings') renderStats();
  if(p==='texts') renderTextsAdmin('all');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AFFILIATES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveAffiliate(){
  const editId=document.getElementById('edit-aff-id').value;
  const id=document.getElementById('aff-id').value.trim();
  const promo=document.getElementById('aff-promo').value.trim();
  if(!id||!promo){toast('Affiliate ID and Promo Code are required','err');return;}

  let affs=getData('affiliates',[]);
  const obj={
    id,name:document.getElementById('aff-name').value.trim(),
    promoCode:promo,
    playerLink:document.getElementById('aff-player').value.trim(),
    apkLink:document.getElementById('aff-apk').value.trim(),
    iosLink:document.getElementById('aff-ios').value.trim(),
    lang:document.getElementById('aff-lang').value,
  };
  if(editId){
    affs=affs.map(a=>a.id===editId?obj:a);
  } else {
    if(affs.find(a=>a.id.toLowerCase()===id.toLowerCase())){toast('ID already exists','err');return;}
    affs.push(obj);
  }
  setData('affiliates',affs);
  clearAffForm();
  renderAffiliates();
  toast('Affiliate saved!');
}

function clearAffForm(){
  ['aff-id','aff-name','aff-promo','aff-player','aff-apk','aff-ios'].forEach(f=>document.getElementById(f).value='');
  document.getElementById('edit-aff-id').value='';
  document.getElementById('aff-form-title').textContent='Add New Affiliate';
}

function renderAffiliates(){
  const affs=getData('affiliates',[]);
  const tbody=document.getElementById('aff-tbody');
  if(!affs.length){tbody.innerHTML='<tr><td colspan="5" style="color:var(--muted);text-align:center;padding:20px">No affiliates yet</td></tr>';return;}
  tbody.innerHTML=affs.map(a=>`
    <tr>
      <td><strong>${a.id}</strong></td>
      <td>${a.name||'â€”'}</td>
      <td><span class="badge badge-green">${a.promoCode}</span></td>
      <td>${LANG_NAMES[a.lang]||a.lang}</td>
      <td>
        <div class="btn-row">
          <button class="btn btn-amber" style="padding:5px 12px;font-size:.75rem" onclick="editAffiliate('${a.id}')">Edit</button>
          <button class="btn btn-red" style="padding:5px 12px;font-size:.75rem" onclick="deleteAffiliate('${a.id}')">Delete</button>
        </div>
      </td>
    </tr>`).join('');
}

function editAffiliate(id){
  const a=getData('affiliates',[]).find(x=>x.id===id);
  if(!a) return;
  document.getElementById('edit-aff-id').value=a.id;
  document.getElementById('aff-id').value=a.id;
  document.getElementById('aff-name').value=a.name||'';
  document.getElementById('aff-promo').value=a.promoCode;
  document.getElementById('aff-player').value=a.playerLink||'';
  document.getElementById('aff-apk').value=a.apkLink||'';
  document.getElementById('aff-ios').value=a.iosLink||'';
  document.getElementById('aff-lang').value=a.lang||'en';
  document.getElementById('aff-form-title').textContent='Edit Affiliate';
  document.getElementById('page-affiliates').scrollIntoView({behavior:'smooth'});
}

function deleteAffiliate(id){
  if(!confirm('Delete affiliate '+id+'?')) return;
  setData('affiliates',getData('affiliates',[]).filter(a=>a.id!==id));
  renderAffiliates();
  toast('Deleted');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BANNERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let bannerImageData=null;
let promoConfig={x:0,y:0,w:0,h:0,fontSize:28,color:'#ffffff'};
let isDragging=false, dragStart={x:0,y:0};
let canvasScale=1;

function toggleDates(){
  const ev=document.getElementById('ban-type').value==='evergreen';
  document.getElementById('start-grp').style.display=ev?'none':'flex';
  document.getElementById('end-grp').style.display=ev?'none':'flex';
}

function loadBannerPreview(){
  const file=document.getElementById('ban-file').files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=function(e){
    bannerImageData=e.target.result;
    const img=new Image();
    img.onload=function(){
      const canvas=document.getElementById('preview-canvas');
      const area=document.getElementById('preview-area');
      const maxW=area.clientWidth-4;
      canvasScale=maxW/img.width;
      canvas.width=img.width; canvas.height=img.height;
      canvas.style.width=maxW+'px'; canvas.style.height=(img.height*canvasScale)+'px';
      const ctx=canvas.getContext('2d'); ctx.drawImage(img,0,0);
      document.getElementById('preview-placeholder').style.display='none';
      canvas.style.display='block';
      setupDrag(canvas, img.width, img.height);
    };
    img.src=e.target.result;
  };
  reader.readAsDataURL(file);
}

function setupDrag(canvas, imgW, imgH){
  const overlay=document.getElementById('promo-overlay');
  const area=document.getElementById('preview-area');

  function getPos(e){
    const r=canvas.getBoundingClientRect();
    const cx=(e.touches?e.touches[0].clientX:e.clientX)-r.left;
    const cy=(e.touches?e.touches[0].clientY:e.clientY)-r.top;
    return {x:cx/canvasScale, y:cy/canvasScale};
  }

  canvas.addEventListener('mousedown',e=>{
    isDragging=true; dragStart=getPos(e);
    overlay.style.display='block';
  });
  window.addEventListener('mousemove',e=>{
    if(!isDragging) return;
    const cur=getPos(e);
    const x=Math.min(dragStart.x,cur.x), y=Math.min(dragStart.y,cur.y);
    const w=Math.abs(cur.x-dragStart.x), h=Math.abs(cur.y-dragStart.y);
    promoConfig.x=Math.round(x); promoConfig.y=Math.round(y);
    promoConfig.w=Math.round(w); promoConfig.h=Math.round(h);
    // position overlay
    const r=canvas.getBoundingClientRect();
    const ar=area.getBoundingClientRect();
    overlay.style.left=(r.left-ar.left+x*canvasScale)+'px';
    overlay.style.top=(r.top-ar.top+y*canvasScale)+'px';
    overlay.style.width=(w*canvasScale)+'px';
    overlay.style.height=(h*canvasScale)+'px';
    updateOverlay();
  });
  window.addEventListener('mouseup',()=>{
    if(!isDragging) return; isDragging=false;
    document.getElementById('promo-config-display').style.display='block';
    updateOverlay();
  });
}

function updateOverlay(){
  promoConfig.fontSize=parseInt(document.getElementById('pc-fontsize').value)||28;
  promoConfig.color=document.getElementById('pc-color').value;
  promoConfig.align='center';
  document.getElementById('pc-info').value=`x:${promoConfig.x} y:${promoConfig.y} w:${promoConfig.w} h:${promoConfig.h}`;
}

function saveBanner(){
  if(!bannerImageData){toast('Please upload a banner image','err');return;}
  const lang=document.getElementById('ban-lang').value;
  const type=document.getElementById('ban-type').value;
  const evergreen=type==='evergreen';
  if(!evergreen){
    const s=document.getElementById('ban-start').value;
    const en=document.getElementById('ban-end').value;
    if(!s||!en){toast('Please set start and end dates','err');return;}
  }
  const b={
    id:uid(), lang, evergreen,
    startDate:evergreen?null:document.getElementById('ban-start').value,
    endDate:evergreen?null:document.getElementById('ban-end').value,
    imageData:bannerImageData,
    promoConfig: promoConfig.w>0 ? {...promoConfig} : null,
  };
  const banners=getData('banners',[]);
  banners.push(b);
  setData('banners',banners);
  clearBannerForm();
  renderBanners();
  toast('Banner saved!');
}

function clearBannerForm(){
  document.getElementById('ban-file').value='';
  bannerImageData=null;
  promoConfig={x:0,y:0,w:0,h:0,fontSize:28,color:'#ffffff'};
  document.getElementById('preview-placeholder').style.display='flex';
  document.getElementById('preview-canvas').style.display='none';
  document.getElementById('promo-overlay').style.display='none';
  document.getElementById('promo-config-display').style.display='none';
}

function renderBanners(){
  const banners=getData('banners',[]);
  const tbody=document.getElementById('ban-tbody');
  if(!banners.length){tbody.innerHTML='<tr><td colspan="5" style="color:var(--muted);text-align:center;padding:20px">No banners yet</td></tr>';return;}
  tbody.innerHTML=banners.map(b=>`
    <tr>
      <td><img src="${b.imageData}" style="height:48px;width:80px;object-fit:cover;border-radius:4px;border:1px solid var(--border)"/></td>
      <td><span class="badge ${b.evergreen?'badge-amber':'badge-green'}">${b.evergreen?'Evergreen':'Dated'}</span></td>
      <td>${LANG_NAMES[b.lang]||b.lang}</td>
      <td style="font-size:.78rem">${b.evergreen?'No expiry':(b.startDate+' â†’ '+b.endDate)}</td>
      <td><button class="btn btn-red" style="padding:5px 12px;font-size:.75rem" onclick="deleteBanner('${b.id}')">Delete</button></td>
    </tr>`).join('');
}

function deleteBanner(id){
  if(!confirm('Delete this banner?')) return;
  setData('banners',getData('banners',[]).filter(b=>b.id!==id));
  renderBanners();
  toast('Deleted');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TEXTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let textFilter='all';

function saveText(){
  const editId=document.getElementById('edit-text-id').value;
  const content=document.getElementById('txt-content').value.trim();
  const lang=document.getElementById('txt-lang').value;
  if(!content){toast('Caption text is required','err');return;}

  let texts=getData('texts',getDefaultTexts());
  const obj={id:editId||uid(), lang, content};
  if(editId){
    texts=texts.map(t=>t.id===editId?obj:t);
  } else {
    texts.push(obj);
  }
  setData('texts',texts);
  clearTextForm();
  renderTextsAdmin(textFilter);
  toast('Caption saved!');
}

function clearTextForm(){
  document.getElementById('txt-content').value='';
  document.getElementById('edit-text-id').value='';
  document.getElementById('text-form-title').textContent='Add New Caption';
}

function filterTexts(lang){
  textFilter=lang;
  renderTextsAdmin(lang);
}

function renderTextsAdmin(lang){
  const texts=getData('texts',getDefaultTexts());
  const filtered=lang==='all'?texts:texts.filter(t=>t.lang===lang);
  const cont=document.getElementById('texts-admin-list');
  if(!filtered.length){cont.innerHTML='<div style="color:var(--muted);padding:20px;text-align:center">No captions for this language</div>';return;}
  cont.innerHTML=filtered.map(t=>`
    <div style="background:var(--card2);border:1px solid var(--border);border-radius:8px;padding:14px;margin-bottom:10px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <span class="badge badge-green">${LANG_NAMES[t.lang]||t.lang}</span>
        <div class="btn-row">
          <button class="btn btn-amber" style="padding:4px 10px;font-size:.72rem" onclick="editText('${t.id}')">Edit</button>
          <button class="btn btn-red" style="padding:4px 10px;font-size:.72rem" onclick="deleteText('${t.id}')">Delete</button>
        </div>
      </div>
      <pre style="white-space:pre-wrap;font-family:'Outfit',sans-serif;font-size:.8rem;color:var(--text);line-height:1.6">${escHtml(t.content.substring(0,200))}${t.content.length>200?'â€¦':''}</pre>
    </div>`).join('');
}

function editText(id){
  const t=getData('texts',getDefaultTexts()).find(x=>x.id===id);
  if(!t) return;
  document.getElementById('edit-text-id').value=t.id;
  document.getElementById('txt-lang').value=t.lang;
  document.getElementById('txt-content').value=t.content;
  document.getElementById('text-form-title').textContent='Edit Caption';
  document.getElementById('page-texts').scrollIntoView({behavior:'smooth'});
}

function deleteText(id){
  if(!confirm('Delete this caption?')) return;
  setData('texts',getData('texts',getDefaultTexts()).filter(t=>t.id!==id));
  renderTextsAdmin(textFilter);
  toast('Deleted');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function changePassword(){
  const cur=document.getElementById('cur-pw').value;
  const nw=document.getElementById('new-pw').value;
  const conf=document.getElementById('conf-pw').value;
  const stored=localStorage.getItem('adminPw')||'admin123';
  if(cur!==stored){toast('Current password incorrect','err');return;}
  if(nw!==conf){toast('New passwords do not match','err');return;}
  if(nw.length<4){toast('Password too short','err');return;}
  localStorage.setItem('adminPw',nw);
  toast('Password updated!');
  ['cur-pw','new-pw','conf-pw'].forEach(f=>document.getElementById(f).value='');
}

function exportData(){
  const d={affiliates:getData('affiliates',[]),banners:getData('banners',[]),texts:getData('texts',[])};
  const blob=new Blob([JSON.stringify(d,null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
  a.download='megapari-data-'+Date.now()+'.json'; a.click();
  toast('Exported!');
}
function importDataPrompt(){ document.getElementById('import-file').click(); }
function importData(){
  const file=document.getElementById('import-file').files[0];
  if(!file) return;
  const r=new FileReader();
  r.onload=function(e){
    try{
      const d=JSON.parse(e.target.result);
      if(d.affiliates) setData('affiliates',d.affiliates);
      if(d.banners) setData('banners',d.banners);
      if(d.texts) setData('texts',d.texts);
      toast('Data imported!');
      refreshAll();
    }catch(err){toast('Invalid file','err');}
  };
  r.readAsText(file);
}
function clearAllData(){
  if(!confirm('This will delete ALL affiliates, banners, and captions. Are you sure?')) return;
  if(!confirm('FINAL WARNING: All data will be lost. Continue?')) return;
  ['affiliates','banners','texts'].forEach(k=>localStorage.removeItem(k));
  toast('All data cleared');
  refreshAll();
}

function renderStats(){
  const a=getData('affiliates',[]).length;
  const b=getData('banners',[]).length;
  const t=getData('texts',[]).length;
  document.getElementById('stats-area').innerHTML=`
    <div>ğŸ‘¥ Affiliates: <strong style="color:var(--text)">${a}</strong></div>
    <div>ğŸ–¼ï¸ Banners: <strong style="color:var(--text)">${b}</strong></div>
    <div>âœï¸ Captions: <strong style="color:var(--text)">${t}</strong></div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(msg,type){
  const t=document.getElementById('admin-toast');
  t.textContent=msg;
  t.style.background=type==='err'?'var(--red)':'var(--green)';
  t.style.color=type==='err'?'#fff':'#000';
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2500);
}
function escHtml(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML;}
function refreshAll(){renderAffiliates();renderBanners();renderTextsAdmin('all');}

function getDefaultTexts(){
  const en=[
    {id:'e1',lang:'en',content:`âš½ğŸ”¥ BIG MATCH ENERGY STARTS HERE!\nTurn every game into real winnings with Megapari. Odds are hot, payouts are fast, and the action never stops.\nğŸ¯ Register now: {{Player link}}\nğŸ“² Android APK: {{apk link}}\nğŸ iOS app: {{iOS link}}\nğŸ Use promo code: {{Promo code}}\nDon't just watch football â€” profit from it.`},
    {id:'e2',lang:'en',content:`Smart bettors don't chase luck â€” they use the right platform.\nMegapari gives you competitive odds, live betting, and instant withdrawals so you stay ahead of the game.\nğŸ‘‰ Join here: {{Player link}}\nğŸ“¥ Android: {{apk link}}\nğŸ“± iOS: {{iOS link}}\nğŸ’° Promo code: {{Promo code}}\nBet smarter. Win faster.`},
    {id:'e3',lang:'en',content:`ğŸš¨ TODAY'S GAMES = TODAY'S PROFITS\nIf you're watching football without betting on Megapari, you're missing money.\nSign up now and activate your bonus instantly.\nğŸ”— Register: {{Player link}}\nğŸ“² Download APK: {{apk link}}\nğŸ iOS: {{iOS link}}\nğŸ Promo code: {{Promo code}}\nDon't sit out the action.`},
    {id:'e4',lang:'en',content:`Our winning community is growing daily âš½ğŸ’¬\nJoin thousands of football fans turning predictions into cash with Megapari.\nStart here: {{Player link}}\nAndroid app: {{apk link}}\niOS app: {{iOS link}}\nPromo code: {{Promo code}}\nYou watch the games anyway â€” you might as well get paid.`},
    {id:'e5',lang:'en',content:`Trusted odds. Fast payouts. Real results.\nMegapari is built for serious football bettors who want performance, not excuses.\nRegister: {{Player link}}\nAPK download: {{apk link}}\niOS download: {{iOS link}}\nUse code: {{Promo code}}\nPlay like a pro.`},
    {id:'e6',lang:'en',content:`Weekend football hits different when you've got money on the line ğŸ˜âš½\nMake every goal count with Megapari.\nSign up: {{Player link}}\nAndroid: {{apk link}}\niOS: {{iOS link}}\nPromo code: {{Promo code}}\nFun to watch. Better to win.`},
    {id:'e7',lang:'en',content:`ğŸ Bonus unlocked. All that's missing is you.\nCreate your Megapari account and activate your promo reward today.\nğŸ‘‰ Register: {{Player link}}\nğŸ“² APK: {{apk link}}\nğŸ iOS: {{iOS link}}\nPromo code: {{Promo code}}\nClaim it. Bet it. Win it.`},
  ];
  const fr=[
    {id:'f1',lang:'fr',content:`âš½ğŸ”¥ L'Ã‰NERGIE DES GRANDS MATCHS COMMENCE ICI!\nTransformez chaque match en vrais gains avec Megapari. Les cotes sont allÃ©chantes, les paiements rapides, et l'action ne s'arrÃªte jamais.\nğŸ¯ Inscrivez-vous: {{Player link}}\nğŸ“² APK Android: {{apk link}}\nğŸ App iOS: {{iOS link}}\nğŸ Code promo: {{Promo code}}\nNe regardez plus le football â€” profitez-en.`},
    {id:'f2',lang:'fr',content:`Les parieurs intelligents ne courent pas aprÃ¨s la chance â€” ils utilisent la bonne plateforme.\nMegapari vous offre des cotes compÃ©titives, les paris en direct et des retraits instantanÃ©s.\nğŸ‘‰ Rejoignez ici: {{Player link}}\nğŸ“¥ Android: {{apk link}}\nğŸ“± iOS: {{iOS link}}\nğŸ’° Code promo: {{Promo code}}\nPariez plus intelligemment. Gagnez plus vite.`},
    {id:'f3',lang:'fr',content:`ğŸš¨ LES MATCHS D'AUJOURD'HUI = LES PROFITS D'AUJOURD'HUI\nSi vous regardez le football sans parier sur Megapari, vous perdez de l'argent.\nInscrivez-vous maintenant.\nğŸ”— S'inscrire: {{Player link}}\nğŸ“² APK: {{apk link}}\nğŸ iOS: {{iOS link}}\nğŸ Code promo: {{Promo code}}\nNe ratez pas l'action.`},
  ];
  const ar=[
    {id:'a1',lang:'ar',content:`âš½ğŸ”¥ Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø© ØªØ¨Ø¯Ø£ Ù‡Ù†Ø§!\nØ­ÙˆÙ‘Ù„ ÙƒÙ„ Ù…Ø¨Ø§Ø±Ø§Ø© Ø¥Ù„Ù‰ Ø£Ø±Ø¨Ø§Ø­ Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ø¹ Megapari. Ø§Ù„Ø£ÙˆØ¶Ø§Ø¹ Ø±Ø§Ø¦Ø¹Ø©ØŒ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø³Ø±ÙŠØ¹Ø© ÙˆØ§Ù„Ø¥Ø«Ø§Ø±Ø© Ù„Ø§ ØªØªÙˆÙ‚Ù.\nğŸ¯ Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¢Ù†: {{Player link}}\nğŸ“² ØªØ·Ø¨ÙŠÙ‚ Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯: {{apk link}}\nğŸ ØªØ·Ø¨ÙŠÙ‚ iOS: {{iOS link}}\nğŸ ÙƒÙˆØ¯ Ø§Ù„ØªØ±ÙˆÙŠØ¬: {{Promo code}}\nÙ„Ø§ ØªÙƒØªÙÙ Ø¨Ù…Ø´Ø§Ù‡Ø¯Ø© ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù… â€” Ø§Ø³ØªÙØ¯ Ù…Ù†Ù‡Ø§.`},
    {id:'a2',lang:'ar',content:`Ø§Ù„Ù…Ø±Ø§Ù‡Ù†ÙˆÙ† Ø§Ù„Ø£Ø°ÙƒÙŠØ§Ø¡ Ù„Ø§ ÙŠØ·Ø§Ø±Ø¯ÙˆÙ† Ø§Ù„Ø­Ø¸ â€” ÙŠØ³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ØµØ­ÙŠØ­Ø©.\nÙŠÙ…Ù†Ø­Ùƒ Megapari Ø£ÙØ¶Ù„ Ø§Ù„Ø£ÙˆØ¶Ø§Ø¹ØŒ Ø§Ù„Ø±Ù‡Ø§Ù† Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙˆØ³Ø­Ø¨ ÙÙˆØ±ÙŠ.\nğŸ‘‰ Ø§Ù†Ø¶Ù… Ù‡Ù†Ø§: {{Player link}}\nğŸ“¥ Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯: {{apk link}}\nğŸ“± iOS: {{iOS link}}\nğŸ’° ÙƒÙˆØ¯ Ø§Ù„ØªØ±ÙˆÙŠØ¬: {{Promo code}}\nØ±Ø§Ù‡Ù† Ø¨Ø°ÙƒØ§Ø¡. Ø§ÙÙˆØ² Ø¨Ø³Ø±Ø¹Ø©.`},
  ];
  const es=[
    {id:'s1',lang:'es',content:`âš½ğŸ”¥ Â¡LA ENERGÃA DE LOS GRANDES PARTIDOS EMPIEZA AQUÃ!\nConvierte cada partido en ganancias reales con Megapari.\nğŸ¯ RegÃ­strate: {{Player link}}\nğŸ“² APK Android: {{apk link}}\nğŸ App iOS: {{iOS link}}\nğŸ CÃ³digo promo: {{Promo code}}\nNo solo mires el fÃºtbol â€” gana con Ã©l.`},
    {id:'s2',lang:'es',content:`Los apostadores inteligentes no persiguen la suerte â€” usan la plataforma correcta.\nMegapari te ofrece cuotas competitivas, apuestas en vivo y retiros instantÃ¡neos.\nğŸ‘‰ Ãšnete aquÃ­: {{Player link}}\nğŸ“¥ Android: {{apk link}}\nğŸ“± iOS: {{iOS link}}\nğŸ’° CÃ³digo promo: {{Promo code}}\nApuesta mÃ¡s listo. Gana mÃ¡s rÃ¡pido.`},
  ];
  const pt=[
    {id:'p1',lang:'pt',content:`âš½ğŸ”¥ A ENERGIA DOS GRANDES JOGOS COMEÃ‡A AQUI!\nTransforme cada jogo em ganhos reais com a Megapari.\nğŸ¯ Registre-se: {{Player link}}\nğŸ“² APK Android: {{apk link}}\nğŸ App iOS: {{iOS link}}\nğŸ CÃ³digo promo: {{Promo code}}\nNÃ£o apenas assista ao futebol â€” lucre com ele.`},
    {id:'p2',lang:'pt',content:`Os apostadores inteligentes nÃ£o correm atrÃ¡s da sorte â€” usam a plataforma certa.\nA Megapari oferece odds competitivas, apostas ao vivo e saques instantÃ¢neos.\nğŸ‘‰ Junte-se aqui: {{Player link}}\nğŸ“¥ Android: {{apk link}}\nğŸ“± iOS: {{iOS link}}\nğŸ’° CÃ³digo promo: {{Promo code}}\nAposte mais inteligente. Ganhe mais rÃ¡pido.`},
  ];
  return [...en,...fr,...ar,...es,...pt];
}

if(!localStorage.getItem('texts')){setData('texts',getDefaultTexts());}
</script>
</body>
</html>
