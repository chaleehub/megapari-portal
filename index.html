
<!DOCTYPE html>
<html>
<head>
<title>Affiliate Portal</title>
<meta charset="UTF-8"/>
</head>
<body>

<h2>Search Affiliate</h2>
<input id="searchInput" placeholder="Enter Affiliate ID or Promo Code">
<button onclick="searchAffiliate()">Search</button>

<h3>Results</h3>
<pre id="results"></pre>

<script type="module">
import { db, collection, getDocs } from './firebase.js';

window.searchAffiliate = async function() {
  const val = searchInput.value.toLowerCase();
  const snap = await getDocs(collection(db, "affiliates"));
  let found = null;

  snap.forEach(doc => {
    const data = doc.data();
    if(data.id.toLowerCase() === val || data.promo.toLowerCase() === val){
      found = data;
    }
  });

  if(!found){
    results.textContent = "Affiliate not found.";
    return;
  }

  let text = "Affiliate Found:\n" + JSON.stringify(found, null, 2);

  const captions = await getDocs(collection(db, "captions"));
  text += "\n\nCAPTIONS:\n";
  captions.forEach(doc => text += "- " + doc.data().text + "\n");

  const banners = await getDocs(collection(db, "banners"));
  text += "\nBANNERS:\n";
  banners.forEach(doc => text += "- " + doc.data().url + "\n");

  results.textContent = text;
};
</script>

</body>
</html>
